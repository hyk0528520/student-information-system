<!DOCTYPE html>
<html lang="zh-CN" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>添加学生 - 学生信息管理系统</title>
    <link rel="stylesheet" href="https://cdn.bootcdn.net/ajax/libs/twitter-bootstrap/5.3.0/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.bootcdn.net/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .page-header {
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e9ecef;
        }

        .page-title {
            font-size: 24px;
            font-weight: 600;
            color: #333;
            margin: 0;
        }

        .card {
            border: none;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .card-body {
            padding: 25px;
        }

        .form-row {
            display: flex;
            flex-wrap: wrap;
            margin: 0 -10px;
        }

        .form-col {
            flex: 0 0 50%;
            max-width: 50%;
            padding: 0 10px;
            margin-bottom: 20px;
        }

        .form-group {
            margin-bottom: 0;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #495057;
            font-size: 14px;
        }

        .form-control, .form-select {
            width: 100%;
            height: 38px;
            padding: 6px 12px;
            font-size: 14px;
            line-height: 1.5;
            color: #495057;
            background-color: #fff;
            background-clip: padding-box;
            border: 1px solid #ced4da;
            border-radius: 4px;
            transition: border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out;
        }

        .form-control:focus, .form-select:focus {
            border-color: #667eea;
            outline: 0;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .required::after {
            content: " *";
            color: #dc3545;
        }

        .form-actions {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid #e9ecef;
        }

        .btn {
            padding: 8px 24px;
            font-size: 14px;
            font-weight: 500;
            border-radius: 4px;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            background: linear-gradient(135deg, #5a67d8 0%, #6b46c1 100%);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }

        .btn-outline-secondary {
            border: 1px solid #6c757d;
            color: #6c757d;
            background: transparent;
        }

        .btn-outline-secondary:hover {
            background-color: #6c757d;
            color: white;
        }

        .form-hint {
            font-size: 12px;
            color: #6c757d;
            margin-top: 4px;
        }

        @media (max-width: 768px) {
            .form-col {
                flex: 0 0 100%;
                max-width: 100%;
            }

            .container {
                padding: 15px;
            }

            .card-body {
                padding: 20px;
            }
        }
    </style>
</head>
<body>
<!-- 导航栏 -->
<nav class="navbar navbar-dark bg-dark">
    <div class="container">
        <a class="navbar-brand" th:href="@{/}">
            <i class="fas fa-graduation-cap me-2"></i>
            学生信息管理系统
        </a>
        <div>
            <a th:href="@{/student/list}" class="btn btn-outline-light btn-sm">
                <i class="fas fa-arrow-left me-1"></i>返回列表
            </a>
        </div>
    </div>
</nav>

<div class="container mt-4">
    <!-- 页面标题 -->
    <div class="page-header">
        <div class="d-flex justify-content-between align-items-center">
            <h1 class="page-title">
                <i class="fas fa-user-plus me-2"></i>添加学生
            </h1>
            <div class="d-flex align-items-center">
                <span class="badge bg-warning text-dark me-2">请填写完整信息</span>
                <a th:href="@{/student/list}" class="btn btn-outline-secondary btn-sm">
                    <i class="fas fa-list me-1"></i>查看学生列表
                </a>
            </div>
        </div>
    </div>

    <!-- 表单卡片 -->
    <div class="card">
        <div class="card-body">
            <form th:action="@{/student/add}" method="post" id="addForm">
                <!-- 消息提示 -->
                <div th:if="${success}" class="alert alert-success alert-dismissible fade show mb-4" role="alert">
                    <i class="fas fa-check-circle me-2"></i>
                    <span th:text="${success}"></span>
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                </div>
                <div th:if="${error}" class="alert alert-danger alert-dismissible fade show mb-4" role="alert">
                    <i class="fas fa-exclamation-circle me-2"></i>
                    <span th:text="${error}"></span>
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                </div>

                <!-- 第一行：学号、姓名 -->
                <div class="form-row">
                    <div class="form-col">
                        <div class="form-group">
                            <label for="studentNo" class="form-label required">学号</label>
                            <input type="text" class="form-control" id="studentNo" name="studentNo"
                                   placeholder="例如：2022001" required
                                   pattern="\d{7,20}" title="学号应为7-20位数字">
                            <div class="form-hint">请输入7-20位的数字学号</div>
                        </div>
                    </div>
                    <div class="form-col">
                        <div class="form-group">
                            <label for="studentName" class="form-label required">姓名</label>
                            <input type="text" class="form-control" id="studentName" name="studentName"
                                   placeholder="请输入学生姓名" required>
                            <div class="form-hint">请输入真实中文姓名</div>
                        </div>
                    </div>
                </div>

                <!-- 第二行：性别、出生日期 -->
                <div class="form-row">
                    <div class="form-col">
                        <div class="form-group">
                            <label for="gender" class="form-label required">性别</label>
                            <select class="form-select" id="gender" name="gender" required>
                                <option value="0" selected>男</option>
                                <option value="1">女</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-col">
                        <div class="form-group">
                            <label for="birthday" class="form-label">出生日期</label>
                            <input type="date" class="form-control" id="birthday" name="birthday">
                            <div class="form-hint">格式：yyyy-mm-dd</div>
                        </div>
                    </div>
                </div>

                <!-- 第三行：身份证号、手机号 -->
                <div class="form-row">
                    <div class="form-col">
                        <div class="form-group">
                            <label for="idCard" class="form-label">身份证号</label>
                            <input type="text" class="form-control" id="idCard" name="idCard"
                                   placeholder="请输入身份证号"
                                   pattern="\d{17}[\dXx]" title="请输入正确的身份证号格式">
                            <div class="form-hint">15位或18位身份证号，最后一位可以是X</div>
                        </div>
                    </div>
                    <div class="form-col">
                        <div class="form-group">
                            <label for="phone" class="form-label required">手机号</label>
                            <input type="tel" class="form-control" id="phone" name="phone"
                                   placeholder="请输入手机号" required
                                   pattern="1[3-9]\d{9}" title="请输入正确的手机号格式">
                            <div class="form-hint">11位手机号，以1开头</div>
                        </div>
                    </div>
                </div>

                <!-- 第四行：学院、专业 -->
                <div class="form-row">
                    <div class="form-col">
                        <div class="form-group">
                            <label for="college" class="form-label required">学院</label>
                            <select class="form-select" id="college" name="college" required>
                                <option value="">请选择学院</option>
                                <option value="计算机学院">计算机学院</option>
                                <option value="信息学院">信息学院</option>
                                <option value="软件学院">软件学院</option>
                                <option value="网络空间安全学院">网络空间安全学院</option>
                                <option value="人工智能学院">人工智能学院</option>
                                <option value="数据科学与大数据学院">数据科学与大数据学院</option>
                                <option value="管理学院">管理学院</option>
                                <option value="经济学院">经济学院</option>
                                <option value="外国语学院">外国语学院</option>
                                <option value="其他">其他</option>
                            </select>
                            <div class="form-hint">请选择学生所在学院</div>
                        </div>
                    </div>
                    <div class="form-col">
                        <div class="form-group">
                            <label for="major" class="form-label required">专业</label>
                            <input type="text" class="form-control" id="major" name="major"
                                   placeholder="例如：软件工程" required>
                            <div class="form-hint">请输入学生所学专业</div>
                        </div>
                    </div>
                </div>

                <!-- 第五行：班级、入学年份 -->
                <div class="form-row">
                    <div class="form-col">
                        <div class="form-group">
                            <label for="className" class="form-label required">班级</label>
                            <input type="text" class="form-control" id="className" name="className"
                                   placeholder="例如：软件2201班" required>
                            <div class="form-hint">格式：专业+年级+班级，如"软件2201班"</div>
                        </div>
                    </div>
                    <div class="form-col">
                        <div class="form-group">
                            <label for="enrollmentYear" class="form-label required">入学年份</label>
                            <input type="number" class="form-control" id="enrollmentYear" name="enrollmentYear"
                                   placeholder="例如：2022" min="2000" max="2030" required>
                            <div class="form-hint">请输入4位数字入学年份</div>
                        </div>
                    </div>
                </div>

                <!-- 第六行：邮箱、状态 -->
                <div class="form-row">
                    <div class="form-col">
                        <div class="form-group">
                            <label for="email" class="form-label">邮箱</label>
                            <input type="email" class="form-control" id="email" name="email"
                                   placeholder="例如：example@qq.com">
                            <div class="form-hint">请输入有效的邮箱地址</div>
                        </div>
                    </div>
                    <div class="form-col">
                        <div class="form-group">
                            <label for="status" class="form-label required">状态</label>
                            <select class="form-select" id="status" name="status" required>
                                <option value="1" selected>在读</option>
                                <option value="2">休学</option>
                                <option value="3">毕业</option>
                                <option value="4">退学</option>
                            </select>
                            <div class="form-hint">请选择学生当前状态</div>
                        </div>
                    </div>
                </div>

                <!-- 第七行：家庭住址 -->
                <div class="form-row">
                    <div class="form-col" style="flex: 0 0 100%; max-width: 100%;">
                        <div class="form-group">
                            <label for="address" class="form-label">家庭住址</label>
                            <textarea class="form-control" id="address" name="address"
                                      rows="2" placeholder="请输入详细家庭住址"></textarea>
                            <div class="form-hint">请填写省、市、区及详细地址</div>
                        </div>
                    </div>
                </div>

                <!-- 第八行：紧急联系人、紧急电话 -->
                <div class="form-row">
                    <div class="form-col">
                        <div class="form-group">
                            <label for="emergencyContact" class="form-label">紧急联系人</label>
                            <input type="text" class="form-control" id="emergencyContact" name="emergencyContact"
                                   placeholder="请输入紧急联系人姓名">
                            <div class="form-hint">请填写紧急联系人姓名</div>
                        </div>
                    </div>
                    <div class="form-col">
                        <div class="form-group">
                            <label for="emergencyPhone" class="form-label">紧急联系电话</label>
                            <input type="tel" class="form-control" id="emergencyPhone" name="emergencyPhone"
                                   placeholder="请输入紧急联系电话"
                                   pattern="\d{7,15}" title="请输入7-15位数字电话">
                            <div class="form-hint">请填写紧急联系电话</div>
                        </div>
                    </div>
                </div>

                <!-- 表单操作按钮 -->
                <div class="form-actions">
                    <button type="reset" class="btn btn-outline-secondary">
                        <i class="fas fa-redo me-1"></i>重置
                    </button>
                    <button type="submit" class="btn btn-primary" id="submitBtn">
                        <i class="fas fa-save me-1"></i>添加学生
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- 快速提示 -->
    <div class="card mt-3">
        <div class="card-body py-2">
            <div class="d-flex align-items-center text-muted">
                <i class="fas fa-info-circle me-2 text-info"></i>
                <small>提示：标有 * 的字段为必填项。添加成功后，系统将自动跳转到学生列表页面。</small>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.bootcdn.net/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.bootcdn.net/ajax/libs/jquery/3.7.0/jquery.min.js"></script>
<script>
    $(document).ready(function() {
        // 自动生成学号（年份+随机数）
        $('#studentNo').on('focus', function() {
            if (!$(this).val()) {
                var year = new Date().getFullYear();
                var random = Math.floor(1000 + Math.random() * 9000);
                $(this).val(year + random);
            }
        });

        // 自动填充入学年份
        $('#enrollmentYear').on('focus', function() {
            if (!$(this).val()) {
                var year = new Date().getFullYear();
                $(this).val(year);
            }
        });

        // 表单验证
        $('#addForm').on('submit', function(e) {
            // 禁用提交按钮防止重复提交
            $('#submitBtn').prop('disabled', true).html('<i class="fas fa-spinner fa-spin me-1"></i>添加中...');

            // 验证必填项
            var requiredFields = $(this).find('[required]');
            var isValid = true;

            requiredFields.each(function() {
                var $field = $(this);
                if (!$field.val().trim()) {
                    $field.addClass('is-invalid');
                    isValid = false;
                } else {
                    $field.removeClass('is-invalid');
                }
            });

            // 验证手机号格式
            var phone = $('#phone').val();
            if (phone && !/^1[3-9]\d{9}$/.test(phone)) {
                $('#phone').addClass('is-invalid');
                $('#phone').after('<div class="invalid-feedback">请输入正确的手机号格式</div>');
                isValid = false;
            }

            // 验证身份证号格式
            var idCard = $('#idCard').val();
            if (idCard && !/(^\d{15}$)|(^\d{18}$)|(^\d{17}(\d|X|x)$)/.test(idCard)) {
                $('#idCard').addClass('is-invalid');
                $('#idCard').after('<div class="invalid-feedback">请输入正确的身份证号</div>');
                isValid = false;
            }

            // 验证邮箱格式
            var email = $('#email').val();
            if (email && !/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) {
                $('#email').addClass('is-invalid');
                $('#email').after('<div class="invalid-feedback">请输入正确的邮箱格式</div>');
                isValid = false;
            }

            if (!isValid) {
                e.preventDefault();
                $('#submitBtn').prop('disabled', false).html('<i class="fas fa-save me-1"></i>添加学生');

                // 显示错误提示
                showToast('请检查表单中的错误信息！', 'warning');

                // 滚动到第一个错误位置
                $('html, body').animate({
                    scrollTop: $('.is-invalid').first().offset().top - 100
                }, 500);
            }
        });

        // 实时验证
        $('input, select').on('blur', function() {
            var $field = $(this);
            var value = $field.val().trim();

            if ($field.prop('required') && !value) {
                $field.addClass('is-invalid');
            } else {
                $field.removeClass('is-invalid');
            }
        });

        // 显示提示信息
        function showToast(message, type) {
            // 移除现有的toast
            $('.toast-container').remove();

            // 创建toast
            var toastHtml = `
                    <div class="toast-container position-fixed top-0 end-0 p-3">
                        <div class="toast align-items-center text-white bg-${type === 'success' ? 'success' : type === 'error' ? 'danger' : 'warning'} border-0" role="alert" aria-live="assertive" aria-atomic="true">
                            <div class="d-flex">
                                <div class="toast-body">
                                    <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : 'info-circle'} me-2"></i>
                                    ${message}
                                </div>
                                <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
                            </div>
                        </div>
                    </div>
                `;

            $('body').append(toastHtml);

            // 显示toast
            var toast = new bootstrap.Toast($('.toast')[0], {
                animation: true,
                autohide: true,
                delay: 3000
            });
            toast.show();

            // 隐藏后移除
            $('.toast').on('hidden.bs.toast', function() {
                $(this).closest('.toast-container').remove();
            });
        }

        // 学院选择变化时自动填充专业示例
        $('#college').on('change', function() {
            var college = $(this).val();
            var majorMap = {
                '计算机学院': '计算机科学与技术',
                '软件学院': '软件工程',
                '信息学院': '信息管理与信息系统',
                '网络空间安全学院': '网络空间安全',
                '人工智能学院': '人工智能',
                '数据科学与大数据学院': '数据科学与大数据技术',
                '管理学院': '工商管理',
                '经济学院': '经济学',
                '外国语学院': '英语'
            };

            if (majorMap[college] && !$('#major').val()) {
                $('#major').val(majorMap[college]);
            }
        });

        // 自动填充班级
        $('#major, #enrollmentYear').on('change', function() {
            var major = $('#major').val();
            var year = $('#enrollmentYear').val();

            if (major && year && year.length === 4 && !$('#className').val()) {
                var className = major.substring(0, 2) + year.substring(2) + '01班';
                $('#className').val(className);
            }
        });
    });
</script>
</body>
</html>